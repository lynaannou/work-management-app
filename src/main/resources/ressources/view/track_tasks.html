<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECLIPSEWORK - Task List</title>

    <!-- ================== STYLES (UNCHANGED) ================== -->
<style>

:root {
  --blue: #0078D4;
  --text-main: #323130;
  --text-secondary: #9B9A98;

  --success: #2CD787;
  --danger: #E03336;
  --warning: #F2C94C;

  --bg-page: #F3F2F1;
  --bg-card: #FFFFFF;
  --border: #D9D9D9;
}


* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Segoe UI", system-ui, sans-serif;
}


body {
  background: var(--bg-page);
  min-height: 100vh;
}


.navbar {
  background: white;
  border-bottom: 1px solid var(--border);
  padding: 16px 40px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-size: 16px;
  font-weight: 700;
  color: var(--blue);
}

.nav-links {
  display: flex;
  gap: 30px;
}

.nav-links a {
  text-decoration: none;
  color: var(--text-secondary);
  font-size: 14px;
}

.nav-links a.active {
  color: var(--text-main);
  font-weight: 600;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 14px;
}

.user-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: #E6F2FB;
  display: flex;
  align-items: center;
  justify-content: center;
}


.table-container {
  background: var(--bg-card);
  margin: 40px;
  padding: 24px;
  border-radius: 10px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}


.table-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.table-title {
  font-size: 20px;
  font-weight: 600;
  color: var(--text-main);
}

.sort-controls a {
  background: var(--blue);
  color: white;
  text-decoration: none;
  padding: 8px 14px;
  border-radius: 6px;
  font-size: 13px;
}


.tasks-table {
  width: 100%;
  border-collapse: collapse;
}

.tasks-table th {
  background: #F3F2F1;
  color: var(--text-main);
  font-size: 12px;
  text-transform: uppercase;
  padding: 10px;
  text-align: left;
}

.tasks-table td {
  padding: 12px 10px;
  font-size: 13px;
  color: var(--text-main);
  border-bottom: 1px solid var(--border);
}


.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  font-weight: 600;
}

.status-badge::before {
  content: "";
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.status-done::before {
  background: var(--success);
}

.status-todo::before {
  background: var(--danger);
}

.status-inprogress::before {
  background: var(--warning);
}


.tasks-table a {
  color: var(--blue);
  text-decoration: none;
  font-weight: 600;
}


.action-buttons button {
  border: none;
  background: transparent;
  color: var(--blue);
  font-size: 13px;
  cursor: pointer;
}


@media (max-width: 900px) {
  .table-container {
    margin: 20px;
  }

  .tasks-table {
    display: block;
    overflow-x: auto;
  }
}
</style>
</head>

<body>

<!-- ================== NAVBAR ================== -->
<nav class="navbar">
    <div class="logo">ECLIPSEWORK</div>
</nav>

<!-- ================== TABLE ================== -->
<div class="table-container">
    <button class="back-btn" onclick="goProjects()">Back to Projects</button>
    <h1 style="margin-bottom:20px;">TASK LIST</h1>
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
    

    <button
        onclick="addTask()"
        style="
            background:#4A6FA5;
            color:white;
            border:none;
            padding:10px 16px;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
        ">
        ➕ Add Task
    </button>
</div>


    <table class="tasks-table">
        <thead>
        <tr>
            <th>TASK</th>
            <th>DESCRIPTION</th>
            <th>DUE</th>
            <th>STATUS</th>
            <th>ACTIONS</th>
        </tr>
        </thead>
        <tbody id="tasksTableBody"></tbody>
    </table>
</div>

<!-- ================== SCRIPT ================== -->
<script>
function goProjects() {
    window.java?.goProjects?.();
}
let currentTasks = [];

/* ---------- LOAD TASKS ---------- */
function loadTasks() {

    if (!window.currentTeamId) {
        console.warn("⏳ Waiting for currentTeamId...");
        return;
    }

    try {
        console.log("✅ Loading tasks for team", window.currentTeamId);

        const json = window.javaBridge.loadTasksAsJson(window.currentTeamId);
        console.log("RAW JSON FROM JAVA =", json);
        currentTasks = JSON.parse(json);


        renderTasks();

    } catch (e) {
        console.error("❌ loadTasks failed", e);
        document.getElementById("tasksTableBody").innerHTML =
            `<tr><td colspan="5">❌ Failed to load tasks</td></tr>`;
    }
}

/* ---------- RENDER ---------- */
function renderTasks() {
    const tbody = document.getElementById("tasksTableBody");

    if (!currentTasks || currentTasks.length === 0) {
        tbody.innerHTML =
            `<tr><td colspan="5">No tasks yet</td></tr>`;
        return;
    }

    tbody.innerHTML = currentTasks.map(t => `
        <tr>
            <td><strong>${t.title}</strong></td>
            <td>${t.description || "-"}</td>
            <td>${t.dueDate || "-"}</td>
            <td>
                <span class="status-badge status-${t.status.toLowerCase().replace("_","")}">
                    ${t.status.replace("_"," ")}
                </span>
            </td>
            <td>
                <button class="action-btn edit-btn" onclick="editTask(${t.id})">Edit</button>
                <button class="action-btn delete-btn" onclick="deleteTask(${t.id})">Delete</button>
            </td>
        </tr>
    `).join("");
}

/* ---------- ACTIONS ---------- */
function editTask(taskId) {
    if (window.javaBridge && window.javaBridge.openEditTask) {
        window.javaBridge.openEditTask(window.currentTeamId, taskId);
    } else {
        console.error("❌ openEditTask not available");
    }
}



function deleteTask(id) {
    if (!confirm("Delete this task?")) return;
    window.javaBridge.deleteTask(id);
    loadTasks();
}

/* ---------- SAFE INIT (JavaFX FIX) ---------- */
function waitForTeamId() {
    if (window.currentTeamId && window.javaBridge) {
        loadTasks();
    } else {
        setTimeout(waitForTeamId, 50);
    }
}

document.addEventListener("DOMContentLoaded", waitForTeamId);
function addTask() {
    if (!window.currentTeamId) {
        alert("No project selected");
        return;
    }

    if (window.javaBridge && window.javaBridge.openNewTaskForm) {
        window.javaBridge.openNewTaskForm(window.currentTeamId);
    } else {
        console.error("❌ openNewTaskForm not available");
    }
}

</script>

</body>
</html>
