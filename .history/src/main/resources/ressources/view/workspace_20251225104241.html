<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ECLIPSEWORK</title>
    <link rel="stylesheet" href="workspace.css" />
</head>

<body>

<script>
/* =====================================================
   REQUIRED ENTRY POINT FOR JAVA
===================================================== */
window.loadDashboard = function (data) {
    console.log("‚úÖ loadDashboard CALLED FROM JAVA", data);
    console.log("üî¥ DASHBOARD PAYLOAD KEYS:", Object.keys(data));
console.log("üî¥ currentUserRole =", data.currentUserRole);
console.log("üî¥ role =", data.role);


    if (!data || !data.workspace) {
        console.error("‚ùå Invalid dashboard payload");
        return;
    }

    /* ===============================
       USER NAME
    =============================== */
    const userNameEl = document.querySelector(".user-name");
    if (data.leader) {
        userNameEl.textContent =
            data.leader.firstName + " " + data.leader.lastName;
    }

    /* ===============================
       EDIT BUTTON (LEAD ONLY)
       ‚úÖ FIXED HERE
    =============================== */
    const editBtn = document.querySelector(".edit-btn");

    if (editBtn && data.currentUserRole === "LEAD") {
        editBtn.style.display = "inline-flex";
        console.log("‚úèÔ∏è Edit button ENABLED (LEAD)");
    } else if (editBtn) {
        editBtn.style.display = "none";
        console.log("üö´ Edit button hidden (MEMBER)");
    }

    /* ===============================
       TITLE
    =============================== */
    document.querySelector(".workspace-title").textContent =
        "Progression ‚Äî " + data.workspace.name;

    /* ===============================
       TASKS
    =============================== */
    const tasksList = document.querySelector(".tasks-list");
    tasksList.innerHTML = "";

    if (!data.tasks || data.tasks.length === 0) {
        tasksList.innerHTML = "<p>No tasks available</p>";
        return;
    }

    data.tasks.forEach((task, i) => {
        const row = document.createElement("div");
        row.className = "task-row";

        const bar = document.createElement("div");
        bar.className = "task-bar";
        bar.textContent = task.title || "Untitled task";

        if (data.startPcts && data.endPcts) {
            bar.style.setProperty("--start", (data.startPcts[i] || 0) + "%");
            bar.style.setProperty("--end", (data.endPcts[i] || 0) + "%");
        }

        row.appendChild(bar);
        tasksList.appendChild(row);
    });
};
</script>

<header>
    <div class="left-zone">
        <h1 class="logo-title">ECLIPSEWORK</h1>

        <nav>
            <a href="#" onclick="goDashboard()">Dashboard</a>
            <a href="#" onclick="goProjects()">Projects</a>
            <a href="#" onclick="goTasks()">Tasks</a>
        </nav>
    </div>

    <div class="user-zone">
        <img src="user.png" class="user-icon" />
        <span class="user-name">‚Äî</span>
    </div>
</header>

<section class="workspace-container">
    <button class="back-btn" onclick="goProjects()">Back to Projects</button>

    <div class="workspace-actions">
        <button class="edit-btn" onclick="editProject()" style="display:none;">
            ‚úé Edit Project
        </button>
    </div>

    <h2 class="workspace-title">Progression</h2>

    <div class="chart-container">
        <div class="chart-header">
            <span>Start Date</span>
            <span>End Date</span>
        </div>
        <div class="tasks-list"></div>
    </div>
</section>

<script>
function goProjects() {
    window.java?.goProjects();
}
function goDashboard() {
    window.java?.goDashboard();
}
function goTasks() {
    window.java?.goTasks();
}

function editProject() {
    window.java?.navigateTo("project-form.html");
}
</script>

</body>
</html>
